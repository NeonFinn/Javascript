<!--
		Name: Finn Baldwin
		Date: 07/2/25
		Class: CSCI2447, Javascript Fundamentals
		Project 6
 -->

<!DOCTYPE html>
<html>
  <head>

    <title>Pizza Game</title>
    <link href="css/game.css" rel="stylesheet" />
    <meta charset ="utf-8">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Joti+One&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="img/favicon.png">
    <script src="jquery-3.7.1.min.js"></script>

  </head>
  <body>

   <div id="wrapper">
	<div id="content">
        <div id="leftside" class="col1">
            <h1>Pepperoni Picker</h1>

            <p id="directions">You own Pizza Palace, and your new employee made a pepperoni pizza. The only
            problem is that the customer wanted a cheese pizza! You need to pick off all the pepperoni before it gets
            to the customer.</p>

            <p id="usergreeting"> </p>

            <div class="controls">
                    <span id="score">0 pts</span>
                <div class="timer">30 seconds left</div>
            </div>

            <button type="button" id="start_button">Start!</button>

        </div>

		<div id="gamespace"></div>

	</div>

</div>
  <script>
      // global variables
      let gamerName = "";
      let score = 0;
      let secondsLeft = 30;
      let timerInterval = null;
      let imageInterval = null;

      // prompt for the user's name
      gamerName = prompt("What is your name?");

      // greet user and say time limit
      document.getElementById("usergreeting").textContent = (`Hurry and fix the pizza ${gamerName}! You have 30 seconds before the customer picks it up!`);

      // generate random x coordinates within the game space
      function randomX() {
          let screenWidth = $("#gamespace").width() - 120;
          return Math.floor(Math.random() * screenWidth);
      }

      // generate random y coordinates within the game space
      function randomY() {
          let screenHeight = $("#gamespace").height() - 120;
          return Math.floor(Math.random() * screenHeight);
      }

      // increase and update score when pepperoni is clicked
      function increaseScore() {
          score += 1;
          document.getElementById("score").textContent = `${score} pts`;
      }

      // update the timer every second and end the game when time runs out
      function updateTimer() {
          if (secondsLeft > 0) {
              secondsLeft -= 1;
              $(".timer").text(`${secondsLeft} seconds left`);

          } else { // if time is up, clear intervals and show final score
              clearInterval(timerInterval);
              clearTimeout(imageInterval);
              $(".timer").text("Time's up!");
              $("#start_button").prop("disabled", false).on("click", start);
              $("#gamespace").empty();

              alert(`Time's up! You scored ${score} points, ${gamerName}!`);
          }
      }

      // add a pepperoni image to the game space randomly
      function addImage() {
          if (secondsLeft <= 0) return; // Do not add new images if game ended

          let x = randomX();
          let y = randomY();
          let id = `pep${Date.now()}_${Math.floor(Math.random() * 1000)}`; // unique ID for each image

          let img = $(`<img src='img/pepperoni.png' class='pizza' id='${id}' alt='Pepperoni Piece' style='position:absolute; width:120px; left:${x}px; top:${y}px;'>`);
          $("#gamespace").append(img);

          // set random disappearance time
          let randomDisappearanceTime = Math.floor(Math.random() * 2000) + 1000;

          setTimeout(() => {
               if (secondsLeft > 0) {
                    $(`#${id}`).remove(); // remove the image if it wasn't clicked and time is still running
               }
            }, randomDisappearanceTime);
      }

      // start the game and remove previous game elements
      function start() {
          clearInterval(timerInterval);
          clearTimeout(imageInterval);

          score = 0;
          secondsLeft = 30;
          $("#score").text(`${score} pts`);
          $(".timer").text(`${secondsLeft} seconds left`).show();
          $("#gamespace").empty();
          $("#start_button").prop("disabled", true).off("click");

          timerInterval = setInterval(updateTimer, 1000);

          // spawn pepperoni images at random intervals
          (function spawn() {
               addImage();
               if (secondsLeft > 0) {
                    let delay = Math.floor(Math.random() * 2000);
                    imageInterval = setTimeout(spawn, delay);
               }
          })();
      }

      $(document).ready(function() {
      $("footer").load("load.html");
          $("#start_button").on("click", start);

          $("#start_button").css({
              backgroundColor: "#fae7ad",
              color: "black",
              border: "2px solid #f0c36d",
              borderRadius: "5px",
              padding: "10px 10px",
              fontSize: "18px",
              fontFamily: "Comic Sans MS"
          });

          $("#gamespace").on("click", ".pizza", function() {
              $(this).remove();
              increaseScore();
          });
      });
  </script>

  <footer></footer>
  </body>
</html>
